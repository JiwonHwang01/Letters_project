{% extends 'base.html' %}

{% block title %}내 편지함 - Letters{% endblock %}

{% block style %}
    <style>
        .letter-card {
            background: var(--background-card);
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            transition: all 0.2s ease;
            cursor: pointer;
            box-shadow: var(--shadow-sm);
        }
        
        .letter-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary-color);
        }
        
        .letter-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }
        
        .letter-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        .letter-author {
            font-weight: 500;
        }
        
        .letter-date {
            font-size: 0.85rem;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
        }
        
        .empty-icon {
            font-size: 4rem;
            margin-bottom: 16px;
        }
        
        /* 우편함 아이콘과 뱃지 스타일 */
        .postbox-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: var(--spacing-xl) 0;
            position: relative;
        }
        
        .postbox-icon {
            position: relative;
            display: inline-block;
        }
        
        .postbox-image {
            width: 180px;
            height: 180px;
            object-fit: contain;
            border-radius: 15px;
            filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.15));
        }
        
        .notification-badge {
            position: absolute;
            top: -12px;
            right: -12px;
            background: #FF3B30;
            color: white;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            font-weight: 700;
            border: 4px solid white;
            box-shadow: 0 3px 12px rgba(255, 59, 48, 0.4);
            animation: badgePulse 2s infinite;
        }
        
        /* 뱃지 숫자가 두 자리 이상일 때 */
        .notification-badge.large {
            width: 42px;
            height: 36px;
            border-radius: 18px;
            font-size: 0.95rem;
        }
        
        /* 뱃지 숫자가 세 자리 이상일 때 */
        .notification-badge.extra-large {
            width: 48px;
            height: 36px;
            border-radius: 18px;
            font-size: 0.9rem;
        }
        
        @keyframes badgePulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .postbox-label {
            text-align: center;
            margin-top: var(--spacing-md);
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        @media (min-width: 768px) {
            .postbox-image {
                width: 220px;
                height: 220px;
            }
            
            .notification-badge {
                width: 42px;
                height: 42px;
                font-size: 1.1rem;
                top: -15px;
                right: -15px;
            }
            
            .notification-badge.large {
                width: 50px;
                height: 42px;
                border-radius: 21px;
                font-size: 1rem;
            }
            
            .notification-badge.extra-large {
                width: 56px;
                height: 42px;
                border-radius: 21px;
                font-size: 0.95rem;
            }
        }
    </style>
{% endblock %}

{% block content %}
    <div class="header">
        <div class="logo">📬 내 편지함</div>
    </div>

    {% if letter_list %}
        {% with my_letters=letter_list|length %}
            <div class="postbox-container">
                <div class="postbox-icon">
                    {% load static %}
                    <img src="{% static 'img/postbox.png' %}" alt="우편함" class="postbox-image">
                    {% if my_letters > 0 %}
                        <div class="notification-badge{% if my_letters >= 100 %} extra-large{% elif my_letters >= 10 %} large{% endif %}">
                            {% if my_letters > 999 %}999+{% else %}{{ my_letters }}{% endif %}
                        </div>
                    {% endif %}
                </div>
            </div>
            <div class="postbox-label">
                {% if my_letters == 0 %}
                    편지함이 비어있습니다
                {% elif my_letters == 1 %}
                    새로운 편지 1통
                {% else %}
                    새로운 편지 {{ my_letters }}통
                {% endif %}
            </div>
        {% endwith %}
        
        <div style="margin-top: var(--spacing-xl);">
            {% for data in letter_list %}
                {% if data.user == username %}
                    <div class="letter-card" onclick="location.href='{% url 'letter_detail' data.hash_id %}'">
                        <div class="letter-title">{{ data.title }}</div>
                        <div class="letter-meta">
                            <div class="letter-author">✍️ {{ data.visitor_id }}</div>
                            <div class="letter-date">📅 {{ data.pub_date|date:'Y-m-d' }}</div>
                        </div>
                    </div>
                {% endif %}
            {% endfor %}
        </div>
    {% else %}
        <div class="postbox-container">
            <div class="postbox-icon">
                {% load static %}
                <img src="{% static 'img/postbox.png' %}" alt="우편함" class="postbox-image">
            </div>
        </div>
        <div class="postbox-label">편지함이 비어있습니다</div>
        
        <div class="card" style="margin-top: var(--spacing-xl);">
            <div class="empty-state">
                <div class="empty-icon">📭</div>
                <h3>아직 받은 편지가 없습니다</h3>
                <p>내 URL을 친구들과 공유해보세요!</p>
            </div>
        </div>
    {% endif %}
    
    <div class="btn-group mt-lg">
        <button type="button" class="btn btn-primary btn-full" onclick="location.href='{% url 'index' %}'">
            🏠 홈으로 돌아가기
        </button>
    </div>
{% endblock %}